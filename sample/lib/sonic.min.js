/*
 * Sonic 0.1
 * --
 * https://github.com/jamespadolsey/Sonic
 * --
 * This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the Do What The Fuck You Want
 * To Public License, Version 2, as published by Sam Hocevar. See
 * http://sam.zoy.org/wtfpl/COPYING for more details. 
 */
(function(){function e(a){this.data=a.path||a.data;this.imageData=[];this.multiplier=a.multiplier||1;this.padding=a.padding||0;this.fps=a.fps||25;this.stepsPerFrame=~~a.stepsPerFrame||1;this.trailLength=a.trailLength||1;this.pointDistance=a.pointDistance||0.05;this.domClass=a.domClass||"sonic";this.fillColor=a.fillColor||"#FFF";this.strokeColor=a.strokeColor||"#FFF";this.stepMethod="string"==typeof a.step?n[a.step]:a.step||n.square;this._setup=a.setup||j;this._teardown=a.teardown||j;this._preStep=
    a.preStep||j;this.width=a.width;this.height=a.height;this.fullWidth=this.width+2*this.padding;this.fullHeight=this.height+2*this.padding;this.domClass=a.domClass||"sonic";this.setup()}var j=function(){},l=e.argTypes={DIM:1,DEGREE:2,RADIUS:3,OTHER:0},p=e.argSignatures={arc:[1,1,3,2,2,0],bezier:[1,1,1,1,1,1,1,1],line:[1,1,1,1]},r=e.pathMethods={bezier:function(a,c,f,b,d,h,q,g,e){a=1-a;var k=1-a,m=a*a,j=k*k,l=m*a,m=3*m*k;a=3*a*j;k*=j;return[l*c+m*h+a*g+k*b,l*f+m*q+a*e+k*d]},arc:function(a,c,f,b,d,h){d=
    (h-d)*a+d;c=[Math.cos(d)*b+c,Math.sin(d)*b+f];c.angle=d;c.t=a;return c},line:function(a,c,f,b,d){return[(b-c)*a+c,(d-f)*a+f]}},n=e.stepMethods={square:function(a){this._.fillRect(a.x-3,a.y-3,6,6)},fader:function(a){this._.beginPath();this._last&&this._.moveTo(this._last.x,this._last.y);this._.lineTo(a.x,a.y);this._.closePath();this._.stroke();this._last=a}};e.prototype={setup:function(){var a,c,f,b,d=this.data;this.canvas=document.createElement("canvas");this._=this.canvas.getContext("2d");this.canvas.className=
    this.domClass;this.canvas.height=this.fullHeight;this.canvas.width=this.fullWidth;this.points=[];for(var h=-1,e=d.length;++h<e;){a=d[h].slice(1);f=d[h][0];if(f in p)for(var g=-1,j=a.length;++g<j;){c=p[f][g];b=a[g];switch(c){case l.RADIUS:b*=this.multiplier;break;case l.DIM:b*=this.multiplier;b+=this.padding;break;case l.DEGREE:b*=Math.PI/180}a[g]=b}a.unshift(0);for(g=b=this.pointDistance;1>=g;g+=b)g=Math.round(1*g/b)/(1/b),a[0]=g,c=r[f].apply(null,a),this.points.push({x:c[0],y:c[1],progress:g})}this.frame=
    0},prep:function(a){if(!(a in this.imageData)){this._.clearRect(0,0,this.fullWidth,this.fullHeight);var c=this.points,f=c.length,b,d;this._setup();for(var h=-1,e=f*this.trailLength;++h<e&&!this.stopped;)if(b=a+h,b=c[b]||c[b-f])this.alpha=Math.round(1E3*(h/(e-1)))/1E3,this._.globalAlpha=this.alpha,this._.fillStyle=this.fillColor,this._.strokeStyle=this.strokeColor,d=a/(this.points.length-1),indexD=h/(e-1),this._preStep(b,indexD,d),this.stepMethod(b,indexD,d);this._teardown();this.imageData[a]=this._.getImageData(0,
    0,this.fullWidth,this.fullWidth);return!0}},draw:function(){this.prep(this.frame)||(this._.clearRect(0,0,this.fullWidth,this.fullWidth),this._.putImageData(this.imageData[this.frame],0,0));this.iterateFrame()},iterateFrame:function(){this.frame+=this.stepsPerFrame;this.frame>=this.points.length&&(this.frame=0)},play:function(){this.stopped=!1;var a=this;this.timer=setInterval(function(){a.draw()},1E3/this.fps)},stop:function(){this.stopped=!0;this.timer&&clearInterval(this.timer)}};window.Sonic=e})();
